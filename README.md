[![Build and Push Docker Image](https://github.com/ttiot/KmlViewer/actions/workflows/docker.yml/badge.svg)](https://github.com/ttiot/KmlViewer/actions/workflows/docker.yml)

# üó∫Ô∏è Visualiseur KML - Application Web Compl√®te

Application web interactive pour visualiser des fichiers KML sur une carte avec navigation entre les points et diff√©rents fonds de carte.

## üöÄ D√©marrage rapide

### Avec Docker (Recommand√©)

1. **Cloner et lancer l'application** :

   ```bash
   git clone https://github.com/ttiot/KmlViewer
   cd kmlViewer
   ./start.sh
   ```

2. **Acc√©der √† l'application** :
   Ouvrez votre navigateur √† l'adresse : **<http://localhost:8080>**

3. **Arr√™ter l'application** :

   ```bash
   ./stop.sh
   ```

### Tests

Installez les d√©pendances et lancez `pytest` :

```bash
cd web-app
pip install -r requirements.txt
pytest
```

## ‚ú® Fonctionnalit√©s principales

### üìÅ Gestion des fichiers KML

- **Upload par glisser-d√©poser** ou s√©lection de fichiers
- **Fichiers d'exemple** int√©gr√©s pour test rapide
- **Support complet** des √©l√©ments KML (traces GPS, points, annotations)
- **Parsing intelligent** des m√©tadonn√©es (nom, description, altitude)
- **Modes d'affichage** : Double unit√© (km/h + kts, ft + m) ou unit√© simple

### üó∫Ô∏è Visualisation cartographique

- **5 fonds de carte** diff√©rents :
  - OpenStreetMap (par d√©faut)
  - Satellite (Esri)
  - Terrain topographique (OpenTopoMap)
  - CartoDB Positron (minimaliste)
  - Stamen Toner (noir et blanc)
- **Affichage optimis√©** des traces GPS et points d'int√©r√™t
- **Marqueurs color√©s** selon le type (points principaux vs annotations)
- **Popups informatifs** avec d√©tails complets

### üß≠ Navigation entre les points

- **Navigation au clavier** : Fl√®ches ‚Üê ‚Üí pour passer d'un point √† l'autre
- **Contr√¥les visuels** : Boutons Pr√©c√©dent/Suivant
- **Centrage automatique** sur le point s√©lectionn√©
- **Informations contextuelles** : Position actuelle (Point X/Y)
- **Clic sur marqueur** pour s√©lection directe
- **Liste interactive** des points avec navigation

### üìä Analyse de trajectoire avanc√©e

- **Statistiques compl√®tes** : Distance, dur√©e, vitesses, d√©nivel√©s
- **Graphiques interactifs** : Profils d'√©l√©vation et de vitesse
- **D√©tection d'arr√™ts** automatique avec dur√©e et position
- **Segmentation intelligente** de la trajectoire par type de mouvement
- **Zones de vitesse** color√©es avec pourcentages de r√©partition
- **Analyse du terrain** : Mont√©es, descentes, sections plates
- **Points d'int√©r√™t** d√©tect√©s automatiquement

### ‚úèÔ∏è √âdition de trajectoires

- **Ajout de points** : Clic sur la carte pour cr√©er de nouveaux points
- **Modification de points** : √âdition des noms, descriptions et m√©tadonn√©es
- **Suppression de points** : Retrait de points ind√©sirables
- **Simplification de traces** : R√©duction automatique du nombre de points
- **Interface intuitive** avec modes d'√©dition d√©di√©s

### üì§ Export multi-formats

- **Format GPX** : Compatible avec les appareils GPS et applications de randonn√©e
- **Format CSV** : Pour analyse dans Excel ou autres outils
- **Format GeoJSON** : Standard web pour applications cartographiques
- **Format KML** : Compatible Google Earth et autres visualiseurs
- **Options personnalisables** : Inclusion/exclusion des traces, nom de fichier

### üì± Interface utilisateur

- **Design responsive** compatible mobile/desktop
- **Interface moderne** avec Bootstrap 5
- **Ic√¥nes Font Awesome** pour une meilleure UX
- **Messages d'√©tat** informatifs et color√©s
- **Panneau d'analyse** avec onglets organis√©s
- **Sidebar r√©tractable** pour optimiser l'espace

## üõ†Ô∏è Scripts utilitaires

| Script | Description |
|--------|-------------|
| `./start.sh` | D√©marre l'application avec Docker |
| `./stop.sh` | Arr√™te l'application |
| `./restart.sh` | Red√©marre l'application |
| `./logs.sh` | Affiche les logs en temps r√©el |
| `./cleanup.sh` | Nettoyage complet (conteneurs, images, volumes) |

## üèóÔ∏è Architecture technique

### Backend (Python Flask)

- **Framework** : Flask 2.3.3 avec architecture modulaire par blueprints
- **Parsing KML** : xml.etree.ElementTree avec validation avanc√©e
- **Analyse GPS** : Algorithmes de calcul de distance (Haversine), vitesse, d√©nivel√©
- **Services m√©tier** :
  - `TrajectoryAnalyzer` : Analyses avanc√©es et d√©tection d'arr√™ts
  - `KMLEditor` : √âdition et simplification de traces (Douglas-Peucker)
  - Export multi-formats (GPX, CSV, GeoJSON, KML)
- **API REST** : Endpoints organis√©s par fonctionnalit√©
  - `/api/upload` et `/api/load-sample` : Gestion des fichiers
  - `/api/analysis/*` : Analyses de trajectoires
  - `/api/editor/*` : √âdition de points et traces
  - `/api/export/*` : Export multi-formats
- **S√©curit√©** : Validation des fichiers, noms s√©curis√©s, gestion d'erreurs

### Frontend (JavaScript/HTML/CSS)

- **Cartes** : Leaflet.js avec gestion avanc√©e des couches
- **Graphiques** : Chart.js pour profils d'√©l√©vation et vitesse
- **UI** : Bootstrap 5 + Font Awesome avec interface √† onglets
- **JavaScript ES6** :
  - Navigation entre points avec clavier/souris
  - Modes d'√©dition interactifs
  - Gestion des analyses avanc√©es
  - Export de donn√©es avec t√©l√©chargement automatique
- **Responsive design** : Sidebar r√©tractable, compatible tous √©crans

### D√©ploiement (Docker)

- **Conteneurisation** : Docker + Docker Compose
- **Port** : 8080 (configurable)
- **Volumes** : Montage des fichiers d'exemple et donn√©es temporaires
- **Health checks** : Surveillance automatique de l'application
- **Optimisations** : Image l√©g√®re, cache des d√©pendances

## üìã Utilisation d√©taill√©e

### 1. Charger un fichier KML

**Option A : Upload de fichier**

- Glissez-d√©posez votre fichier .kml dans la zone pr√©vue
- Ou cliquez pour s√©lectionner un fichier
- Le fichier est automatiquement trait√© et affich√©

**Option B : Fichiers d'exemple**

- Cliquez sur un des boutons des fichiers d'exemple
- Parfait pour tester sans avoir ses propres fichiers

### 2. Changer le fond de carte

- Utilisez les boutons radio dans le panneau de gauche
- 5 options disponibles selon vos pr√©f√©rences
- Changement instantan√© sans rechargement

### 3. Naviguer entre les points

**Navigation au clavier :**

- **Fl√®che gauche (‚Üê)** : Point pr√©c√©dent
- **Fl√®che droite (‚Üí)** : Point suivant

**Navigation √† la souris :**

- **Cliquez sur un marqueur** pour le s√©lectionner
- **Boutons Pr√©c√©dent/Suivant** dans le panneau de navigation
- **Bouton "Centrer"** dans les popups
- **Liste des points** : Cliquez sur un point dans la liste pour y naviguer

### 4. Analyser une trajectoire

**Onglet "Stats" :**

- Statistiques g√©n√©rales : distance, dur√©e, vitesses, d√©nivel√©s
- Mise √† jour automatique lors du chargement d'un fichier

**Onglet "√âl√©vation" :**

- Graphique du profil d'√©l√©vation
- Statistiques d√©taill√©es (altitude min/max)

**Onglet "Vitesse" :**

- Graphique du profil de vitesse
- Statistiques d√©taill√©es (vitesse min/moy/max)

**Onglet "Avanc√©" :**

- **Cliquez sur "Lancer l'analyse avanc√©e"** pour obtenir :
  - D√©tection automatique des arr√™ts
  - Segmentation de la trajectoire
  - Zones de vitesse color√©es
  - Analyse du terrain (mont√©es/descentes/plat)
- **Cliquez sur "Effacer"** pour nettoyer les r√©sultats

### 5. √âditer une trajectoire

**Onglet "√âdition" :** üöß Work in progress üöß

- **Ajouter un point** : Cliquez sur le bouton puis sur la carte
- **Modifier un point** : Activez le mode puis cliquez sur un point existant
- **Supprimer un point** : Activez le mode puis cliquez sur le point √† supprimer
- **Simplifier la trace** : R√©duit automatiquement le nombre de points

**Formulaire d'√©dition :**

- Modifiez le nom, la description
- Marquez comme point d'annotation si n√©cessaire
- Sauvegardez ou annulez les modifications

### 6. Exporter les donn√©es

**Onglet "Export" :**

- **GPX** : Format standard pour GPS et applications de randonn√©e
- **CSV** : Tableau pour analyse dans Excel
- **GeoJSON** : Format web pour d√©veloppeurs
- **KML** : Compatible Google Earth

**Options d'export :**

- Cochez "Inclure les points de trace" selon vos besoins
- Personnalisez le nom du fichier
- Le t√©l√©chargement d√©marre automatiquement

### 7. Consulter les informations

- **Cliquez sur un marqueur** pour voir ses d√©tails
- **Panneau d'analyse** avec onglets organis√©s
- **Liste des points** interactive avec recherche visuelle
- **Distinction visuelle** entre points principaux et annotations

## üé® Types de points affich√©s

| Type | Couleur | Description |
|------|---------|-------------|
| **Points principaux** | üîµ Bleu | Points d'int√©r√™t principaux |
| **Annotations** | üî¥ Rouge | Points du dossier "Points" (d√©tails) |
| **Traces GPS** | üü£ Violet | Lignes de trajectoire |

## üîß Configuration avanc√©e

### Variables d'environnement

```bash
FLASK_ENV=production          # Mode de l'application
FLASK_APP=app.py             # Point d'entr√©e
```

### Ports personnalis√©s

Modifiez le fichier `docker-compose.yml` :

```yaml
ports:
  - "VOTRE_PORT:5000"  # Remplacez VOTRE_PORT
```

### Ajout de fonds de carte

Modifiez le fichier `web-app/templates/index.html` dans la section `baseLayers`.

## üêõ D√©pannage

### Probl√®mes courants

**1. Port d√©j√† utilis√©**

```bash
# Changer le port dans docker-compose.yml
# Ou arr√™ter le service utilisant le port 8080
sudo lsof -i :8080
```

**2. Fichier KML non reconnu**

- V√©rifiez que le fichier est un KML valide
- Assurez-vous de l'encodage UTF-8
- Consultez les logs : `./logs.sh`

**3. Carte ne s'affiche pas**

- V√©rifiez votre connexion internet
- Ouvrez la console du navigateur (F12)
- Red√©marrez l'application : `./restart.sh`

**4. Navigation clavier ne fonctionne pas**

- Cliquez sur la carte pour donner le focus
- Assurez-vous qu'un fichier KML avec des points est charg√©

### Logs et diagnostic

```bash
./logs.sh                    # Logs en temps r√©el
docker ps                    # √âtat des conteneurs
docker-compose ps            # √âtat sp√©cifique au projet
```

## üìä Performances

- **Fichiers KML** : Jusqu'√† 16MB support√©s
- **Points** : Navigation optimis√©e pour milliers de points
- **M√©moire** : Conteneur l√©ger (~100MB)
- **D√©marrage** : ~10-30 secondes selon la machine

## üîí S√©curit√©

- **Validation des fichiers** : Extensions et taille limit√©es
- **Noms s√©curis√©s** : Protection contre path traversal
- **Parsing s√©curis√©** : Protection contre XML bombs
- **Pas de persistance** : Fichiers upload√©s temporaires

## ü§ù Contribution

1. Fork du projet
2. Cr√©er une branche feature
3. Commit des modifications
4. Push vers la branche
5. Cr√©er une Pull Request

## üìÑ Licence

Ce projet est libre d'utilisation.

---

## üÜï Nouveaut√©s Phase 4 - Analyse et √âdition Avanc√©es

### üî¨ Analyses automatis√©es

- **D√©tection d'arr√™ts** : Identification automatique des pauses avec dur√©e et localisation
- **Segmentation intelligente** : Division de la trajectoire en segments homog√®nes
- **Zones de vitesse** : Classification color√©e des sections selon la vitesse
- **Analyse du terrain** : R√©partition automatique mont√©es/descentes/plat
- **Points d'int√©r√™t** : D√©tection des lieux remarquables sur le parcours

### ‚úèÔ∏è √âdition interactive

- **Ajout de points** : Cr√©ation de nouveaux waypoints par clic sur carte
- **Modification en temps r√©el** : √âdition des m√©tadonn√©es (nom, description)
- **Suppression s√©lective** : Retrait de points ind√©sirables
- **Simplification Douglas-Peucker** : Optimisation automatique des traces
- **Interface intuitive** : Modes d'√©dition avec feedback visuel

### üìä Export professionnel

- **Multi-formats** : GPX, CSV, GeoJSON, KML avec options personnalisables
- **Compatibilit√© √©tendue** : Support des principaux logiciels GPS et SIG
- **M√©tadonn√©es pr√©serv√©es** : Conservation des informations d'origine
- **T√©l√©chargement direct** : Export instantan√© sans rechargement

## üéØ Cas d'usage typiques

### üõ©Ô∏è Aviation

- **Plans de vol** : Visualisation et √©dition de routes a√©riennes
- **Waypoints** : Gestion des points de navigation
- **Analyse de performance** : Vitesses, altitudes, temps de vol
- **Export vers GPS** : Formats compatibles √©quipements de bord

### ü•æ Randonn√©e et Outdoor

- **Traces GPS** : Visualisation de parcours avec profils d'√©l√©vation
- **Points d'int√©r√™t** : Refuges, sommets, points de vue
- **Analyse d'effort** : D√©nivel√©s, vitesses, temps d'arr√™t
- **Partage** : Export vers applications mobiles (GPX)

### üî¨ Recherche et G√©ologie

- **Points de mesure** : Localisation pr√©cise d'√©chantillons
- **Parcours terrain** : Optimisation des itin√©raires de collecte
- **Analyse spatiale** : Export vers SIG (GeoJSON, CSV)
- **Documentation** : M√©tadonn√©es d√©taill√©es par point

### üèÉ‚Äç‚ôÇÔ∏è Sport et Fitness

- **Entra√Ænements** : Analyse de performances (vitesse, d√©nivel√©)
- **Zones d'effort** : Identification des sections difficiles
- **Progression** : Comparaison de parcours similaires
- **Partage** : Export vers plateformes sportives

### üöó Transport et Logistique

- **Optimisation de routes** : Analyse de trajets commerciaux
- **Points d'arr√™t** : D√©tection automatique des pauses
- **Rapports** : Export de donn√©es pour analyse (CSV)
- **Suivi** : Visualisation de flottes ou livraisons

**Profitez de votre exploration cartographique avanc√©e ! üó∫Ô∏è‚úàÔ∏èüìä**

## üöÄ Nouveaut√©s Phase 5 - Optimisations

- **Calculs vectoris√©s** pour la distance totale (numpy)
- **Mise en cache** des parsings KML/GPX pour √©viter les recalculs
- **Tests suppl√©mentaires** couvrant le cache
- **Instructions de test** : `pytest`
